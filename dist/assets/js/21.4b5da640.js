(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{491:function(a,s,t){"use strict";t.r(s);var e=t(17),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"应用程序打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用程序打包"}},[a._v("#")]),a._v(" 应用程序打包")]),a._v(" "),t("p",[a._v("为缓解 Windows 下路径名过长的 "),t("a",{attrs:{href:"https://github.com/joyent/node/issues/6960",target:"_blank",rel:"noopener noreferrer"}},[a._v("问题"),t("OutboundLink")],1),a._v("， 略微加快一下 "),t("code",[a._v("require")]),a._v("的速度以及隐藏你的源代码，你可以选择把你的应用打包成 "),t("a",{attrs:{href:"https://github.com/electron/asar",target:"_blank",rel:"noopener noreferrer"}},[a._v("asar"),t("OutboundLink")],1),a._v("档案文件，这只需要对你的源代码做一些很小的改动。")]),a._v(" "),t("p",[a._v("大部分用户可以毫不费力地使用这个功能，因为它"),t("a",{attrs:{href:"https://github.com/electron/electron-packager",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("electron-packager")]),t("OutboundLink")],1),a._v(",、"),t("a",{attrs:{href:"https://github.com/electron-userland/electron-forge",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("electron-forge")]),t("OutboundLink")],1),a._v("和"),t("a",{attrs:{href:"https://github.com/electron-userland/electron-builder",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("electron-builder")]),t("OutboundLink")],1),a._v("中都得到了支持，开箱即用。 如果你没有使用这些工具中的任何一个，那么请继续阅读。")]),a._v(" "),t("h2",{attrs:{id:"生成-asar-档案文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成-asar-档案文件"}},[a._v("#")]),a._v(" 生成 "),t("code",[a._v("asar")]),a._v(" 档案文件")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/electron/asar",target:"_blank",rel:"noopener noreferrer"}},[a._v("asar"),t("OutboundLink")],1),a._v(" 是一种将多个文件合并成一个文件的类 tar 风格的归档格式。 Electron 可以无需解压整个文件，即可从其中读取任意文件内容。")]),a._v(" "),t("p",[a._v("参照如下步骤将你的应用打包成 "),t("code",[a._v("asar")]),a._v("归档文件。")]),a._v(" "),t("h3",{attrs:{id:"_1-安装-asar-实用程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-asar-实用程序"}},[a._v("#")]),a._v(" 1. 安装 asar 实用程序")]),a._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g asar\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-使用-asar-pack-打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-asar-pack-打包"}},[a._v("#")]),a._v(" 2. 使用 "),t("code",[a._v("asar pack")]),a._v(" 打包")]),a._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ asar pack your-app app.asar\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h2",{attrs:{id:"使用-asar-档案文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-asar-档案文件"}},[a._v("#")]),a._v(" 使用 "),t("code",[a._v("asar")]),a._v(" 档案文件")]),a._v(" "),t("p",[a._v("在 Electron 中有两类 APIs：Node.js 提供的 Node API 和 Chromium 提供的 Web API。 这两种 API 都支持从 "),t("code",[a._v("asar")]),a._v(" 档案中读取文件。")]),a._v(" "),t("h3",{attrs:{id:"node-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-api"}},[a._v("#")]),a._v(" Node API")]),a._v(" "),t("p",[a._v("由于 Electron 中打了特别补丁， Node API 中如 "),t("code",[a._v("fs.readFile")]),a._v(" 或者 "),t("code",[a._v("require")]),a._v(" 之类 的方法可以将 "),t("code",[a._v("asar")]),a._v(" 视之为虚拟文件夹，读取 asar 里面的文件就和从真实的文件系统中读取一样。")]),a._v(" "),t("p",[a._v("例如，假设我们在 "),t("code",[a._v("/path/to")]),a._v(" 文件夹下有个 "),t("code",[a._v("example.asar")]),a._v(" 包：")]),a._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ asar list /path/to/example.asar\n/app.js\n/file.txt\n/dir/module.js\n/static/index.html\n/static/main.css\n/static/jquery.min.js\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("从 "),t("code",[a._v("asar")]),a._v(" 档案读取一个文件：")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'fs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("readFileSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/path/to/example.asar/file.txt'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("列出档案根目录下的所有文件：")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'fs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("readdirSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/path/to/example.asar'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("使用档案中的模块：")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/path/to/example.asar/dir/module.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("你也可以使用 "),t("code",[a._v("BrowserWindow")]),a._v(" 来显示一个 "),t("code",[a._v("asar")]),a._v(" 档案里的 web 页面：")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" BrowserWindow "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'electron'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" win "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BrowserWindow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\nwin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("loadURL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'file:///path/to/example.asar/static/index.html'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"web-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-api"}},[a._v("#")]),a._v(" Web API")]),a._v(" "),t("p",[a._v("在 Web 页面里，用 "),t("code",[a._v("file:")]),a._v(" 协议可以获取 "),t("code",[a._v("asar")]),a._v(" 包中文件。和 Node API 一样，视 asar 包如虚拟文件夹。")]),a._v(" "),t("p",[a._v("例如，用 "),t("code",[a._v("$.get")]),a._v(" 获取文件:")]),a._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("let")]),a._v(" $ "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./jquery.min.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'file:///path/to/example.asar/file.txt'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("h3",{attrs:{id:"把-asar-档案当作一个普通的文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#把-asar-档案当作一个普通的文件"}},[a._v("#")]),a._v(" 把 "),t("code",[a._v("asar")]),a._v(" 档案当作一个普通的文件")]),a._v(" "),t("p",[a._v("某些情况下，如：对 "),t("code",[a._v("asar")]),a._v(" 档案文件进行校验，我们需要像读取 “文件” 那样读取 "),t("code",[a._v("asar")]),a._v(" 档案文件。 为此你可以使用内置的没有"),t("code",[a._v("asar")]),a._v("功能的和原始"),t("code",[a._v("fs")]),a._v("模块一模一样的"),t("code",[a._v("original-fs")]),a._v("模块。")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" originalFs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'original-fs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\noriginalFs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("readFileSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/path/to/example.asar'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("您也可以将 "),t("code",[a._v("process.noAsar")]),a._v(" 设置为 "),t("code",[a._v("true")]),a._v(" 以禁用 "),t("code",[a._v("fs")]),a._v(" 模块中对 "),t("code",[a._v("asar")]),a._v(" 的支持：")]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'fs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nprocess"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("noAsar "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("readFileSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/path/to/example.asar'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h2",{attrs:{id:"node-api-的局限性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-api-的局限性"}},[a._v("#")]),a._v(" Node API 的局限性")]),a._v(" "),t("p",[a._v("尽管我们已经尽了最大努力使得 "),t("code",[a._v("asar")]),a._v(" 包在 Node API 下的应用尽可能的趋向于真实的目录结构，但仍有一些底层 Node API 我们无法保证其正常工作。")]),a._v(" "),t("h3",{attrs:{id:"档案文件是只读的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#档案文件是只读的"}},[a._v("#")]),a._v(" 档案文件是只读的")]),a._v(" "),t("p",[a._v("档案文件中的内容不可更改，所以 Node APIs 里那些会修改文件的方法在使用"),t("code",[a._v("asar")]),a._v(" 归档文件时都无法正常工作.")]),a._v(" "),t("h3",{attrs:{id:"工作目录不能设置为档案文件里的目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作目录不能设置为档案文件里的目录"}},[a._v("#")]),a._v(" 工作目录不能设置为档案文件里的目录")]),a._v(" "),t("p",[a._v("尽管 "),t("code",[a._v("asar")]),a._v(" 档案是虚拟文件夹，但其实并没有真实的目录架构对应在文件系统里，所以你不可能将 working Directory 设置成 "),t("code",[a._v("asar")]),a._v(" 包里的一个文件夹。 将 asar 中的文件夹以 "),t("code",[a._v("cwd")]),a._v(" 形式作为参数传入一些 API 中也会报错。")]),a._v(" "),t("h3",{attrs:{id:"某些-api-需要额外解压档案包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#某些-api-需要额外解压档案包"}},[a._v("#")]),a._v(" 某些 API 需要额外解压档案包")]),a._v(" "),t("p",[a._v("大部分 "),t("code",[a._v("fs")]),a._v(" API 可以无需解压即从 "),t("code",[a._v("asar")]),a._v(" 档案中读取文件或者文件的信息，但是在处理一些依赖真实文件路径的底层系统方法时，Electron 会将所需文件解压到临时目录下，然后将临时目录下的真实文件路径传给底层系统方法使其正常工作。 对于这类API，会增加一些开销。")]),a._v(" "),t("p",[a._v("以下是一些需要额外解压的 API：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("child_process.execFile")])]),a._v(" "),t("li",[t("code",[a._v("child_process.execFileSync")])]),a._v(" "),t("li",[t("code",[a._v("fs.open")])]),a._v(" "),t("li",[t("code",[a._v("fs.openSync")])]),a._v(" "),t("li",[t("code",[a._v("process.dlopen")]),a._v(" - 用在 "),t("code",[a._v("require")]),a._v(" 原生模块时")])]),a._v(" "),t("h3",{attrs:{id:"fs-stat-的不真实统计信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fs-stat-的不真实统计信息"}},[a._v("#")]),a._v(" "),t("code",[a._v("fs.stat")]),a._v(" 的不真实统计信息")]),a._v(" "),t("p",[a._v("对 "),t("code",[a._v("asar")]),a._v(" 档案中的文件取 "),t("code",[a._v("fs.stat")]),a._v("，返回的 "),t("code",[a._v("Stats")]),a._v(" 对象不是精确值，因为这些文件不是真实存在于文件系统里。 所以除了文件大小和文件类型以外，你不应该依赖 "),t("code",[a._v("Stats")]),a._v(" 对象的值。")]),a._v(" "),t("h3",{attrs:{id:"执行asar档案内的二进制文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行asar档案内的二进制文件"}},[a._v("#")]),a._v(" 执行"),t("code",[a._v("asar")]),a._v("档案内的二进制文件")]),a._v(" "),t("p",[a._v("Node 中有一些可以执行程序的 API，如 "),t("code",[a._v("child_process.exec")]),a._v("，"),t("code",[a._v("child_process.spawn")]),a._v(" 和 "),t("code",[a._v("child_process.execFile")]),a._v(" 等， 但只有 "),t("code",[a._v("execFile")]),a._v(" 可以执行 "),t("code",[a._v("asar")]),a._v(" 包中的程序。")]),a._v(" "),t("p",[a._v("因为 "),t("code",[a._v("exec")]),a._v(" 和 "),t("code",[a._v("spawn")]),a._v(" 允许 "),t("code",[a._v("command")]),a._v(" 替代 "),t("code",[a._v("file")]),a._v(" 作为输入，而 "),t("code",[a._v("command")]),a._v(" 是需要在 shell 下执行的. 目前没有 可靠的方法来判断 command 中是否在操作一个 asar 包中的文件，而且即便可以判断，我们依旧无法保证可以在无任何 副作用的情况下替换 command 中的文件路径。")]),a._v(" "),t("h2",{attrs:{id:"添加未打包的文件到-asar-档案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加未打包的文件到-asar-档案"}},[a._v("#")]),a._v(" 添加未打包的文件到 asar 档案")]),a._v(" "),t("p",[a._v("如上所述，一些节点APIs将在 调用时解压文件。除了性能问题之外，各种抗病毒扫描器可能会因此行为触发 。")]),a._v(" "),t("p",[a._v("有一个解决方法，您可以使用 "),t("code",[a._v("--unpack")]),a._v(" 选项保持各种文件不被压缩。 在下面这个例子中，原生 Node.js 模块的共享库将不会被打包：")]),a._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ asar pack app app.asar --unpack *.node\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("运行命令后，您将会看到 "),t("code",[a._v("app.asar.unpacked")]),a._v(" 文件夹与 "),t("code",[a._v("app.asar")]),a._v(" 文件一起被创建了。 没有被打包的文件和 "),t("code",[a._v("app.asar")]),a._v(" 会一起存档发布。")])])}),[],!1,null,null,null);s.default=r.exports}}]);