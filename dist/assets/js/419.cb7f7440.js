(window.webpackJsonp=window.webpackJsonp||[]).push([[419],{890:function(e,s,t){"use strict";t.r(s);var r=t(17),n=Object(r.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"获取界面上的节点信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取界面上的节点信息"}},[e._v("#")]),e._v(" 获取界面上的节点信息")]),e._v(" "),t("h2",{attrs:{id:"wxml节点信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wxml节点信息"}},[e._v("#")]),e._v(" WXML节点信息")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.createSelectorQuery.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("节点信息查询 API"),t("OutboundLink")],1),e._v(" 可以用于获取节点属性、样式、在界面上的位置等信息。")]),e._v(" "),t("p",[e._v("最常见的用法是使用这个接口来查询某个节点的当前位置，以及界面的滚动位置。")]),e._v(" "),t("p",[t("strong",[e._v("示例代码：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const query = wx.createSelectorQuery()\nquery.select('#the-id').boundingClientRect(function (res) {\n  res.top // #the-id 节点的上边界坐标（相对于显示区域）\n})\nquery.selectViewport().scrollOffset(function (res) {\n  res.scrollTop // 显示区域的竖直滚动位置\n})\nquery.exec()\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[e._v("上述示例中， "),t("code",[e._v("#the-id")]),e._v(" 是一个节点选择器，与 CSS 的选择器相近但略有区别，请参见 "),t("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/SelectorQuery.select.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("SelectorQuery.select"),t("OutboundLink")],1),e._v(" 的相关说明。")]),e._v(" "),t("p",[e._v("在自定义组件或包含自定义组件的页面中，推荐使用 "),t("code",[e._v("this.createSelectorQuery")]),e._v(" 来代替 "),t("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.createSelectorQuery.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("wx.createSelectorQuery")]),t("OutboundLink")],1),e._v(" ，这样可以确保在正确的范围内选择节点。")]),e._v(" "),t("h2",{attrs:{id:"wxml节点布局相交状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wxml节点布局相交状态"}},[e._v("#")]),e._v(" WXML节点布局相交状态")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.createIntersectionObserver.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("节点布局相交状态 API"),t("OutboundLink")],1),e._v(" 可用于监听两个或多个组件节点在布局位置上的相交状态。这一组API常常可以用于推断某些节点是否可以被用户看见、有多大比例可以被用户看见。")]),e._v(" "),t("p",[e._v("这一组API涉及的主要概念如下。")]),e._v(" "),t("ul",[t("li",[e._v("参照节点：监听的参照节点，取它的布局区域作为参照区域。如果有多个参照节点，则会取它们布局区域的 "),t("strong",[e._v("交集")]),e._v(" 作为参照区域。页面显示区域也可作为参照区域之一。")]),e._v(" "),t("li",[e._v("目标节点：监听的目标，默认只能是一个节点（使用 "),t("code",[e._v("selectAll")]),e._v(" 选项时，可以同时监听多个节点）。")]),e._v(" "),t("li",[e._v("相交区域：目标节点的布局区域与参照区域的相交区域。")]),e._v(" "),t("li",[e._v("相交比例：相交区域占参照区域的比例。")]),e._v(" "),t("li",[e._v("阈值：相交比例如果达到阈值，则会触发监听器的回调函数。阈值可以有多个。")])]),e._v(" "),t("p",[e._v("以下示例代码可以在目标节点（用选择器 "),t("code",[e._v(".target-class")]),e._v(" 指定）每次进入或离开页面显示区域时，触发回调函数。")]),e._v(" "),t("p",[t("strong",[e._v("示例代码：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Page({\n  onLoad() {\n    wx.createIntersectionObserver().relativeToViewport().observe('.target-class', (res) => {\n      res.id // 目标节点 id\n      res.dataset // 目标节点 dataset\n      res.intersectionRatio // 相交区域占目标节点的布局区域的比例\n      res.intersectionRect // 相交区域\n      res.intersectionRect.left // 相交区域的左边界坐标\n      res.intersectionRect.top // 相交区域的上边界坐标\n      res.intersectionRect.width // 相交区域的宽度\n      res.intersectionRect.height // 相交区域的高度\n    })\n  }\n})\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br")])]),t("p",[e._v("以下示例代码可以在目标节点（用选择器 "),t("code",[e._v(".target-class")]),e._v(" 指定）与参照节点（用选择器 "),t("code",[e._v(".relative-class")]),e._v(" 指定）在页面显示区域内相交或相离，且相交或相离程度达到目标节点布局区域的20%和50%时，触发回调函数。")]),e._v(" "),t("p",[t("strong",[e._v("示例代码：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Page({\n  onLoad() {\n    wx.createIntersectionObserver(this, {\n      thresholds: [0.2, 0.5]\n    }).relativeTo('.relative-class').relativeToViewport().observe('.target-class', (res) => {\n      res.intersectionRatio // 相交区域占目标节点的布局区域的比例\n      res.intersectionRect // 相交区域\n      res.intersectionRect.left // 相交区域的左边界坐标\n      res.intersectionRect.top // 相交区域的上边界坐标\n      res.intersectionRect.width // 相交区域的宽度\n      res.intersectionRect.height // 相交区域的高度\n    })\n  }\n})\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br")])]),t("p",[e._v("注意：与页面显示区域的相交区域并不准确代表用户可见的区域，因为参与计算的区域是“布局区域”，布局区域可能会在绘制时被其他节点裁剪隐藏（如遇祖先节点中 overflow 样式为 hidden 的节点）或遮盖（如遇 fixed 定位的节点）。")]),e._v(" "),t("p",[e._v("在自定义组件或包含自定义组件的页面中，推荐使用 "),t("code",[e._v("this.createIntersectionObserver")]),e._v(" 来代替 "),t("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.createIntersectionObserver.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("wx.createIntersectionObserver")]),t("OutboundLink")],1),e._v(" ，这样可以确保在正确的范围内选择节点。")])])}),[],!1,null,null,null);s.default=n.exports}}]);