# 补充

## ajax提交

ajax特点异步

作用：采用异步方式完成前后台数据交互。

ajax可以在页面不刷新、不跳转的情况下与后台进行数据交互的一种技术。

同步(串联) 当前操作会影响后续代码执行
异步(并联) 当前操作不会影响后续代码执行

### 实现步骤

1. 创建ajax对象
   var xhr = new XMLHttpRequest();

2. 请求配置
   xhr.open("请求方法","请求地址","请求方式")
   HTTP请求方法 GET POST PUT DELETE
   请求地址  提交数据、获取数据地址
   请求方式(默认false 异步)  同步、异步

3. 发送请求
   xhr.send([数据])
   数据：URL编码 或 FormData
   var fd = new FormData();
   fd.append("key","value")

4. 事件监听，等待响应结果

```js
xhr.onreadystatechange = function(){
 if(xhr.readyState  == 4){
  if(xhr.status == 200){
	//获取响应结果
	xhr.response
	xhr.responseText
	xhr.responseXML
	//将 json字符串转换为对象
	JSON.parse()
	}
  }
}

xhr.onload = function(){
	if(xhr.status == 200){
	xhr.response
	}
	if(xhr.status == 404){

	}
}
// get 请求数据是放到地址栏
// URL编码 需要自己拼接
xxxx.com/xxxx.php?key1=val1&key2=val2
xhr.send()
// post 请求数据放到请求体

xhr.send([数据])
xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded;charset=utf-8');
xhr.send("key1=val1&key2=val2")

var fd = new FormData();
xhr.send(fd)
```

问题：

1. A请求 结果 被B请求依赖  B请求结果 被C依赖
   回调地狱|回调金字塔
   ```js
   ajax({
		url:"a.com",
		success:function(res){
			ajax({
				url:"b.com"+ res.xxx,
				success:function(res){
					ajax({
						url:"c.com"+ res.xxx
						success:function(){

						}
					})
				}
			})
		}
   })
	var resa = ajax()
	var resb = ajax()
	var resc = ajax()
	```

2. 获取10个地址的结果
	```js
	Promise.all([
		pObj,
		pObj,
		pObj,
		....
	])
	.then(res=>{
		res 10个请求的结果
	})
	```
	**当前请求依赖上一个请求结果的情况**

	```js
	new Primise(function(reslove,reject){
		ajax({
			url:"a.com",
			success:function(res){
				reslove(res)
			},
			error:function(err){
				reject(err)
			}
		})
	}).then(res=>{
		return new Primise(function(reslove,reject){
			ajax({
				url:"b.com"+ res,
				success:function(res){
					reslove(res)
				},
				error:function(err){
					reject(err)
				}
			})
		})
	}).then(res=>{
		return new Primise(function(reslove,reject){
			ajax({
				url:"c.com"+ res,
				success:function(res){
					reslove(res)
				},
				error:function(err){
					reject(err)
				}
			})
		})
	}).then(res=>{
		c的结果
	})
	```
	
    **需要得到多个地址的结果**

	```js
	var p1 = new Promise()  1s
	var p2 = new Promise()  1.5s
	var p3 = new Promise()  3s 
	var p4 = new Promise()   10s
	var p5 = new Promise()  6s
	Promise.all([p1,p2,p3,p4,p5]).then(res=>{
		res 5个请求的结果
	})

	function axios(options){
		return new Promise(function(reslove,reject){
			ajax({
				url:options.url,
				type:options.type,
				success:function(res){
					reslove(res)
				},
				error:function(err){
					reject(err)
				}
			})
		})
	}
	```