# 组件插槽

**插槽（Slot）** 是Vue提出来的一个概念，正如名字一样，插槽用于决定将组件中包含的内容，插入到组件模板某个指定位置。

## 插槽

> Vue 实现了一套内容分发的 API，这套 API 的设计灵感源自 [Web Components 规范草案](https://github.com/w3c/webcomponents/blob/gh-pages/proposals/Slots-Proposal.md)，将 `<slot>` 元素作为承载分发内容的出口。

当想要在父组件中放入内容（子组件或者标签），如下例。 但是由于父组件 `my-componen` 自身可能存在模版，所以无法知晓 `<h1>` 标签所放置位置，即 `<h1>` 插入无效果。

```html
<div id="app">
    <my-component>
        <h1>Hello Vue!</h1>
    </my-componen>
</div>
```

为了解决这个问题，我们会在父组件模版中预留出位置`<slot>`标签，来放置父组件中的内容（如上例的 `<h1>`），`<slot>`元素是一个内容插槽。

```html
<template id="my-component">
    <div>
        这是组件内容
        <slot></slot>
    </div>
</template>
<script>
    Vue.component("my-component",{
        template:"#my-component"
    })
    new Vue({
        el:"#app"
    })
</script>
```

当组件渲染的时候，`<slot></slot>` 将会被替换为“`<h1>Hello Vue!</h1>`”。插槽内可以包含任何模板代码，包括字符串、HTML、组件。

## 后备内容

除非组件内部模板包含至少一个 `<slot>` 插口，否则组件包含的内容将会被丢弃。当组件模板只有一个没有属性的 `slot` 时，组件包含的整个内容片段将插入到 `slot` 所在的 DOM 位置，并替换掉 `slot` 标签本身。如果外部调用时没有提供内容的话，那么它就会使用自己默认提供的内容。

```html
<div id="app">
    <my-component>
        <h1>Hello Vue!</h1>
        <h1>Hello Vue!</h1>
    </my-componen>

    <my-component> </my-component>
</div>
<script>
new Vue({
    el:"#app",
    components:{
        'myComponent':{
            template:"\
            <div>\
                <h1>头部</h1>\
                <slot>如果没有分发内容，则显示slot中的内容</slot>\
                <h1>底部</h1>\
            </div>\
            "
        }
    }
})
</script>
```

## 具名插槽

上面这个示例是一个匿名slot，它只能表示一个插槽。如果需要多个内容插槽，则可以为`<slot>`元素指定name属性。

例如：电脑主板上的各种插槽，有插CPU的，有插显卡的，有插内存的，有插硬盘的，所以假设有个组件是computer，其内容是：

```html
<my-component>
    <h1>电脑配置</h1>
    <template v-slot:cpu>
        <div>Intel Core i7</div>
    </template>
    <template v-slot:gpu>
        <div>GTX980Ti</div>
    </template>
    <template v-slot:memory>
        <div>Kingston 32G</div>
    </template>
    <template v-slot:hard-drive>
        <div>Samsung SSD 1T</div>
    </template>
</my-componen>
```

在向具名插槽提供内容的时候，我们可以在一个 `<template>` 元素上使用 `v-slot` 指令，并以 v-slot 的参数的形式提供其名称。

那么你要装一台电脑，就可以这么写：

```html
<template>
    <div>
        <slot>其他内容</slot>
        <slot name="cpu">这儿插你的CPU</slot>
        <slot name="gpu">这儿插你的显卡</slot>
        <slot name="memory">这儿插你的内存</slot>
        <slot name="hard-drive">这儿插你的硬盘</slot>
    </div>
</template>
```

> 一个不带 name 的 `<slot>` 出口会带有默认的名字“default”。

现在 `<template>` 元素中的所有内容都将会被传入相应的插槽。任何没有被包裹在带有 v-slot 的 `<template>` 中的内容都会被视为默认插槽的内容。

### 具名插槽的缩写

跟 `v-on` 和 `v-bind` 一样，`v-slot` 也有缩写，即把参数之前的所有内容 (`v-slot:`) 替换为字符 `#`。例如 `v-slot:cpu` 可以被重写为 `#cpu`:

```html
<my-component>
    <h1>电脑配置</h1>
    <template #cpu>
        <div>Intel Core i7</div>
    </template>
    <template #gpu>
        <div>GTX980Ti</div>
    </template>
    <template #memory>
        <div>Kingston 32G</div>
    </template>
    <template #hard-drive>
        <div>Samsung SSD 1T</div>
    </template>
</my-componen>
```

### 示例：自定义内容的对话框

```html
<div id="app">
    <modal-dialog v-bind:show.sync="show">
        <template v-slot:header>
            <header class="dialog-header" >
                <h1 class="dialog-title">提示信息</h1>
            </header>
        </template>

        <div class="dialog-body">
            <p>你想在对话框中放什么内容都可以！</p>
            <p>你可以放一段文字，也可以放一些表单，或者是一些图片。</p>
        </div>

        <template v-slot:footer>
            <footer class="dialog-footer">
                <button class="btn" @click="closeDialog">关闭</button>
            </footer>
        </template>
    </modal-dialog>

    <button class="btn btn-open" @click="openDialog">打开对话框</button>
</div>
<template id="dialog-template">
    <div class="dialogs" v-show="show">
        <div class="dialog">
            <div class="dialog-content">
                <slot name="header"></slot>
                <slot></slot>
                <slot name="footer"></slot>
            </div>
        </div>
        <div class="dialog-overlay"></div>
    </div>
</template>
<script>
Vue.component('modal-dialog', {
    template: '#dialog-template',
    props: ['show'],
    methods: {
        close: function() {
            this.show = false
        }
    }
})

new Vue({
    el: '#app',
    data: {
        show: false
    },
    methods: {
        openDialog: function() {
            this.show = true
        },
        closeDialog: function() {
            this.show = false
        }
    }
})
</script>
```

## 作用域插槽

> 在 2.6.0 中，我们为具名插槽和作用域插槽引入了一个新的统一的语法 (即 v-slot 指令)。它取代了 slot 和 slot-scope 这两个目前已被废弃但未被移除且仍在文档中的特性。

在内容分发时，子内容若想获取父组件的数据，则要用到 作用域插槽 这一特殊类型的插槽。

在子组件中，只需将数据传递到插槽，就像将 prop 传递给组件一样：

```html
<div id="app">
    <child>
        <template v-slot:default="props">
            <span>hello from parent</span>
            <span>{{ props.text }}</span>
        </template>
    </child>
</div>

<template id="child">
    <div class="child">
        <slot text="hello from child"></slot>
          <!-- 传递固定值 ：字符串"hello from child" -->
    </div>
</template>

<script>
Vue.component("child",{
    template:"#child"
})
new Vue({
    el:"#app"
})
</script>
```

若要传递父组件中的`data`数据，则需要使用自定义属性 `v-bind` 进行属性绑定

```html
<div id="app">
    <item>
        <template v-slot:default="props">
            <div>姓名：{{props.name}} 年龄：{{props.age}}</div>
        </template>
    </item>
</div>
<template id="item">
    <div>
        <h1>头部</h1>
        <slot v-for='item in users' v-bind='item'></slot>
        <!-- 传递 data 中的数据 : users -->
        <h1>底部</h1>
    </div>
</template>

<script>
Vue.component("item",{
    template:"#item",
    data:function(){
        return {
            users:[
                {name:"张三",age:19},
                {name:"李四",age:20},
                {name:"王五",age:18}
            ]
        }
    }
})
new Vue({
    el:"#app"
})
</script>
```

## 编写可复用组件

在编写组件时，最好考虑好以后是否要进行复用。一次性组件间有紧密的耦合没关系，但是可复用组件应当定义一个清晰的公开接口，同时也不要对其使用的外层数据作出任何假设。

Vue 组件的 API 来自三部分——prop、事件和插槽：

- Prop 允许外部环境传递数据给组件；
- 事件允许从组件内触发外部环境的副作用；
- 插槽允许外部环境将额外的内容组合在组件中。

使用 v-bind 和 v-on 的简写语法，模板的意图会更清楚且简洁：

```html
<my-component
  :foo="baz"
  :bar="qux"
  @event-a="doThis"
  @event-b="doThat"
>
  <img slot="icon" src="...">
  <p slot="main-text">Hello!</p>
</my-component>
```
