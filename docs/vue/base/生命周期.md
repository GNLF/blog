# 生命周期

生命周期就是在Vue实例化的过程中，构造函数执行的不同阶段。 生命周期的每个阶段都会执行对应的函数，这类函数叫做钩子函数。

每个阶段执行的钩子函数如下图：

![生命周期](amWiki/images/lifecycle.png)

## 钩子函数

钩子是一种事件劫持机制，也就是说它会比你的事件更早进行执行处理。

你可以简单地把它理解为vue的内置事件，但是这个内置事件是由你去配置的。

Vue的生命周期钩子函数：

| 钩子函数      | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| beforeCreate  | 在实例初始化之后，数据观测(data observer) 和 event/watcher 事件配置之前被调用。 |
| created       | 实例已经创建完成之后被调用。在这一步，实例已完成以下的配置：数据观测(data observer)，属性和方法的运算， watch/event 事件回调。然而，挂载阶段还没开始，$el 属性目前不可见。 |
| beforeMount   | 在挂载开始之前被调用：相关的 render 函数首次被调用。         |
| mounted       | el 被新创建的 vm.$el 替换，并挂载到实例上去之后调用该钩子。如果 root 实例挂载了一个文档内元素，当 mounted 被调用时 vm.$el 也在文档内。 |
| beforeUpdate  | 数据更新时调用，发生在虚拟 DOM 重新渲染和打补丁之前。你可以在这个钩子中进一步地更改状态，这不会触发附加的重渲染过程。 |
| updated       | 由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。当这个钩子被调用时，组件 DOM 已经更新，所以你现在可以执行依赖于 DOM 的操作。 |
| beforeDestroy | 实例销毁之前调用。在这一步，实例仍然完全可用。               |
| destroyed     | Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。 |

生命周期检测：

```html
<div id="demo">
    <p>{{msg}}</p>
    <button @click="update">更新数据</button>
    <button @click="destroy">销毁</button>
</div>
<script>
var vm = new Vue({
    el:"#demo",
    data:{
        msg:"hello Vue!"
    },
    methods:{
        update:function(){
            this.msg="update msg!"
        },
        destroy() {
            this.$destroy();
        }
    },
    beforeCreate:function(){
        console.log("beforeCreate 实例创建之前")
        console.log('el',this.$el);     //el undefined
        console.log('data',this.$data); //data undefined
        console.log('msg',this.msg);    //msg undefined
    },
    created:function(){
        console.log("created 实例创建之后")
        console.log('el',this.$el);     //el undefined
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg hello Vue!
    },
    beforeMount:function(){
        console.log("beforeMount DOM挂载前")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg hello Vue!
    },
    mounted:function(){
        console.log("mounted DOM挂载后")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg hello Vue!
    },
    beforeUpdate:function(){
        console.log("beforeUpdate 更新前状态")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg update msg!
    },
    updated:function(){
        console.log("updated 更新后状态")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg update msg!
    },
    beforeDestroy:function(){
        console.log("beforeDestroy 销毁之前")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg update msg!
    },
    destroyed:function(){
        console.log("destroyed 销毁之后")
        console.log('el',this.$el);     //el <div id="demo">…</div>
        console.log('data',this.$data); //data {__ob__: Observer}
        console.log('msg',this.msg);    //msg update msg!
    }
})
</script>
```

<iframe src="https://jsrun.pro/hMqKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></iframe>

### create 和 mounted

| 钩子函数      | 描述                            |
| ------------- | ------------------------------- |
| beforecreated | el 和 data 并未初始化           |
| created       | 完成了data 数据的初始化，el没有 |
| beforeMount   | 完成了 el 和 data 初始化        |
| mounted       | 完成挂载                        |

### update

我们单击页面中的“更新数据”按钮，将数据更新。下面就能看到data里的值被修改后，将会触发update的操作。

**注意beforeUpdate是指view层的数据变化前，不是data中的数据改变前触发。因为Vue是数据驱动的。注意观察弹窗就容易发现。**

### destroy

销毁完成后，我们再重新改变message的值，vue不再对此动作进行响应了。但是原先生成的dom元素还存在，可以这么理解，执行了destroy操作，后续就不再受vue控制了。因为这个Vue实例已经不存在了。 我们单击页面中的“销毁”按钮，将指定的Vue实例销毁。

## 生命名周期钩子函数用法

| 函数          | 描述                                               |
| ------------- | -------------------------------------------------- |
| beforecreate  | 举个栗子：可以在这加个loading事件                  |
| created       | 在这结束loading，还做一些初始化，实现函数自执行    |
| mounted       | 在这发起后端请求，拿回数据，配合路由钩子做一些事情 |
| beforeDestory | 你确认删除XX吗？                                   |
| destoryed     | 当前组件已被删除，清空相关内容                     |
