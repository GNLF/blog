# 指令详解

> 指令是我们用来扩展浏览器能力的技术之一。

Vue.js 指令(directive)是以 `v-` 作为前缀的 HTML 属性。

**指令** 提供了一些特殊的特性，将指令绑定在元素上时，指令会为绑定的目标元素添加一些特殊的行为，我们可以将指令看作特殊的HTML特性（attribute）。

## 常用指令

| 序号 |   指令    | 描述                                                 | 重要  |
| :--: | :-------: | :--------------------------------------------------- | ----- |
|  1   |  v-text   | 给元素绑定文本内容                                   | ★★★★★ |
|  2   |  v-html   | 可以识别数据中包含html标签                           | ★★★★☆ |
|  3   |  v-model  | 表单元素双向数据绑定                                 | ★★★★☆ |
|  4   |   v-if    | 根据表达式的真假来删除和插入元素                     | ★★★★☆ |
|  5   |  v-else   | 可以用`v-else`指令为`v-if`或`v-show`添加一个“else块” | ★★★☆☆ |
|  6   | v-else-if | 充当 `v-if` 的“else-if 块”                           | ★★☆☆☆ |
|  7   |  v-show   | 根据条件表达式的值来执行元素的隐藏或者显示行为       | ★★★★☆ |
|  8   |   v-for   | 基于一个数组渲染一个列表                             | ★★★★★ |
|  9   |  v-once   | 当数据改变时，插值处的内容不会更新                   | ★★★☆☆ |
|  10  |  v-bind   | 进行动态的属性（可自定义属性）绑定                   | ★★★★☆ |
|  11  |   v-on    | 用于给监听DOM事件                                    | ★★★★☆ |
|  12  |  v-cloak  | 以隐藏未编译的 Mustache 标签直到实例准备完毕         | ★★☆☆☆ |
|  13  |   v-pre   | v-pre表示该会跳过该标签及其子元素的编译。            | ★★☆☆☆ |

## 详解

### v-text

给元素绑定文本内容

```html
<div id="demo">
    <p v-text="text"></p>
</div>
<script>
new Vue({
  el:"#demo",
  data:{
    text:"这是一段文本"
  }
})
</script>
```

<iframe src="https://jsrun.pro/QuqKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### v-html

双大括号会将数据解释为纯文本，而非 HTML 。为了输出HTML请使用 `v-html` 指令：

```html
<div id="app" v-html="message"></div>
<script>
new Vue({
    el:'#app',
    data:{
        message:'<p> 这段内容是包含在P标签中的！ </p>'
    }
})
</script>
```

<iframe src="https://jsrun.pro/6RiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### v-model

表单元素双向数据绑定

```html
<div id="app">
    <input type="text" v-model="message">
    <p>{{message}}</p>
</div>
<script>
new Vue({
  el:"#demo",
  data:{
    message:"hello world!"
  }
})
</script>
```

当更改文本框的值时，`<p>{{ message }}</p>` 中的内容也会被更新

<iframe src="https://jsrun.pro/IRiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### v-if

v-if是条件渲染指令，它根据表达式的真假来删除和插入元素，它的基本语法如下：

```js
v-if="expression"
```

expression是一个返回boolean值的表达式，表达式可以是一个boolean属性，也可以是一个返回boolean的运算式。例如:

```html
<div id="demo">
    <div v-if="yes">我的值为true</div> // 输出
    <div v-if="no">我的值为false</div> // 不输出
    <div v-if="age<30">年龄为{{age}}</div> //输出
    <div v-if="name.indexOf('i')">{{name}}</div> //输出
</div>
<script>
var app = new Vue({
    el:"#demo",
    data:{
        yes:true,
        no:false,
        age:25,
        name:"lilei"
    }
})
</script>
```

<iframe src="https://jsrun.pro/aRiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### v-show

根据条件表达式的值来执行元素的隐藏或者显示行为。语法与`v-if`相同

```js
v-show="expression"
```

> 与v-if不同的是，使用v-show="expression" 无论expression是否为真，该原素都会被渲染，只是显示或者隐藏。而 v-if 若条件为假，则不会渲染元素。

<iframe src="https://jsrun.pro/3RiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### v-else

可以用`v-else`指令为`v-if`或`v-show`添加一个“else块”。`v-else`元素必须立即跟在`v-if`或`v-show`元素的后面，否则它不能被识别。

```html
<h1 v-if="age <= 25">Age: {{ age }}</h1>
<h1 v-else>"年龄超出限制"</h1>
```

`v-else`元素是否渲染在HTML中，取决于前面使用的是`v-if`还是`v-show`指令。
`v-if`为true，后面的`v-else`不会渲染到HTML；`v-show`为tue，但是后面的`v-else`仍然渲染到HTML中。

### v-else-if

- 2.1版本新增

`v-else-if`，顾名思义，充当 `v-if` 的“else-if 块”。可以链式地使用多次：

```html
<div v-if="type === 'A'"> A </div>
<div v-else-if="type === 'B'"> B </div>
<div v-else-if="type === 'C'">  C </div>
<div v-else>  Not A/B/C  </div>
```

### v-for

`v-for`指令基于一个数组渲染一个列表，它和JavaScript的遍历语法相似：

```js
v-for="data in arr"
// arr是一个数组， data是当前被遍历的数组元素。
```

#### 例：遍历员工数组

```html
<table border=1 cellpadding=5 cellspacing=0 id="app">
    <tr>
        <th>ID</th>
        <th>姓名</th>
        <th>性别</th>
        <th>年龄</th>
    </tr>
    <tr v-for="v in person">
        <td>{v.id}</td>
        <td>{v.name}</td>
        <td>{v.sex}</td>
        <td>{v.age}</td>
    </tr>
</table>
<script>
var vm = new Vue({
    el:'#app',
    data:{
        person:[
            {id:1,name:"张三",sex:"男",age:"26"},
            {id:2,name:"李四",sex:"男",age:"22"},
            {id:2,name:"王五",sex:"女",age:"19"}
        ]
    }
})
</script>
```

<iframe src="https://jsrun.pro/8RiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

数组下标index的使用：

```html
<tr v-for="(data,index) in person">
    <td> {{index}} </td>
    <td> {{data}} </td>
</tr>
```

#### 例：遍历对象

```html
<div id="demo">
        <table border="1">
            <tr>
                <th>序号</th>
                <th>id</th>
                <th>姓名</th>
                <th>年龄</th>
                <th>性别</th>
            </tr>
            <!-- 外层遍历为数组 -->
            <tr v-for="(v,i) in users">
                <td>{{i+1}}</td>
                <!-- 内存遍历为对象 -->
                <td v-for="val in v">{{val}}</td>
            </tr>
        </table>
    </div>
<script>
new Vue({
    el:"#demo",
    data:{
        users:[
            {id:'1001',name:"张三",age:19,sex:"男"},
            {id:'1004',name:"李四",age:21,sex:"女"},
            {id:'1007',name:"王五",age:18,sex:"女"},
            {id:'1020',name:"赵六",age:20,sex:"男"},
        ]
    }
})
</script>
```

> 注意 ：
> 1.0版本index使用方法为 `<tr v-for="data in person"> <td> $index </td> </tr>`， 在2.0版本中该使用方法已被废弃。

第三个参数为索引：

```html
<div v-for="(value, name, index) in object">
  {{ index }}. {{ name }}: {{ value }}
</div>
```

### v-once

当数据改变时，插值处的内容不会更新。其所有的子节点也会将被视为静态内容并跳过。这可以用于优化更新性能。

```html
<div id="demo">
  <!-- 当message更改后 通过v-once绑定数据也不会修改 -->
  <p v-once>v-one：{{message}}</p>
  <span>文本绑定：{{message}}</span><br />
  <input type="text" v-model="message">
</div>
<script>
var app = new Vue({
    el:"#demo",
    data:{
        message:"hello"
    }
})
</script>
```

在控制台通过`app.message`修改内容，发现p标签内容未发生变化，span标签内容发生变化。

<iframe src="https://jsrun.pro/zuqKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="280" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>

### 参数

某些指令可以接收一个“参数”，在指令后以冒号`:`指明。 例如， `v-bind` 指令被用来响应地更新 HTML 属性：

```js
new Vue({
  el:"#demo",
  data:{
    url:'http://www.baidu.com'
  }
})

<a v-bind:href="url"></a>
```

在这里 `href` 是参数，告知 `v-bind` 指令将该元素的 href 属性与表达式 url 的值绑定。

另一个例子是 v-on 指令，它用于监听 DOM 事件：

```html
<a v-on:click="doSomething">...</a>
```

在这里参数是监听的事件名。我们也会更详细地讨论事件处理。

### v-bind

进行动态的属性（可自定义属性）绑定

```html
// 一般形式
<a v-bind:href="'http://www.baidu.com'"></a>
<div v-bind:class="active"></div>
<div v-bind:style="{color:activeColor,fontSize:fontSize + 'px'}"></div>

 // 三元表达式形式
<div v-bind:class="index%2==0?'active':''"></div>   

// 数组形式,其中 class1 和 class2 为vm实例中的属性
v-bind:class = "[class1,class2]";

// json格式，根据值的真假确定属性。其中"boolean"不可省略
v-bind:class = "{ 'one':boolean, 'two':boolean }";
```

v-bind很常用，可缩写为`:`，例如：

```html
<!-- 完整语法 -->
<a v-bind:href="url">...</a>

<!-- 缩写 -->
<a :href="url">...</a>
<a :href="'http://www.baidu.com'"></a>
```

### v-on

v-on指令用于给监听DOM事件，它的用语法和v-bind是类似的。

例如监听元素的点击事件：

```html
<a v-on:click="doSomething">
```

有两种形式调用方法：

1. 绑定一个方法（让事件指向方法的引用）
2. 或者使用内联语句。

将它的单击事件直接绑定到doSomething()方法，而链接2则是调用doSomething()方法。

```html
<a v-on:click="doSomething">
<a v-on:click="doSomething()">
```

v-on很常用，可缩写为`@`，例如：

```html
<!-- 完整语法 -->
<a v-on:click="doSomething">...</a>

<!-- 缩写 -->
<a @click="doSomething">...</a>
```

### v-cloak

这个指令保持在元素上直到关联实例结束编译。和 CSS 规则如 `[v-cloak] { display: none }`一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕，否则在渲染页面时，有可能用户会先看到Mustache标签，然后看到编译后的数据。

```html
<style type="text/css">
    [v-cloak] {
      display: none;
    }
</style>
<div id="app">
    <span>{{message}}</span>
    <span v-cloak>{{message}}</span>
</div>

<script type="text/javascript">
    var app=new Vue({
        el:'#app',
        data:{
            message:'hello vue'
        }
    });
</script>
```

## 综合示例

现在我们已经介绍了一些Vue.js的基础知识了，结合以上知识我们可以来做个小Demo。
员工信息录入与删除：

```html
<div id="app">
    <fieldset>
        <legend>Create New Person</legend>
        <div class="form-group">
            <label>Name:</label>
            <input type="text" v-model="newPerson.name" />
        </div>
        <div class="form-group">
            <label>Age:</label>
            <input type="text" v-model="newPerson.age" />
        </div>
        <div class="form-group">
            <label>Sex:</label>
            <select v-model="newPerson.sex">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>
        <div class="form-group">
            <label></label>
            <button @click="createPerson">Create</button>
        </div>
    </fieldset>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Sex</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(person, index) in people">
                <td>{{ person.name }}</td>
                <td>{{ person.age }}</td>
                <td>{{ person.sex }}</td>
                <td :class="'text-center'">
                    <button @click="deletePerson(index)">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<script>
var vm = new Vue({
    el: '#app',
    data: {
        newPerson: {
            name: '',
            age: 0,
            sex: 'Male'
        },
        people: [
            {name: 'Jack', age: 30,sex: 'Male'},
            {name: 'Bill', age: 26,sex: 'Male'},
            {name: 'Chris',age: 36,sex: 'Male'}
        ]
    },
    methods: {
        createPerson: function() {
            this.people.push(this.newPerson);
            // 添加完newPerson对象后，重置newPerson对象
            this.newPerson = {
                name: '',
                age: 0,
                sex: 'Male'
            }
        },
        deletePerson: function(index) {
            // 删一个数组元素
            this.people.splice(index, 1);
        }
    }
})
</script>
```

<iframe src="https://jsrun.pro/TRiKp/embedded/all/light/" id="JSREMB_18136" width="100%" height="370" frameborder="0" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin" style="box-sizing: border-box;"></iframe>
