# 全局配置

小程序根目录下的 app.json 文件用来对微信小程序进行全局配置，决定页面文件的路径、窗口表现、设置网络超时时间、设置多 tab 等。

## 全局配置实例

```json
{
  "pages": ["pages/index/index", "pages/logs/index"],
  "window": {
    "navigationBarTitleText": "Demo"
  },
  "tabBar": {
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页"
      },
      {
        "pagePath": "pages/logs/logs",
        "text": "日志"
      }
    ]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true,
  "navigateToMiniProgramAppIdList": ["wxe5f52902cf4de896"]
}
```

## app.json 配置项列表

| 属性                           | 类型            | 必填 | 描述                                                | 最低版本                |
| ------------------------------ | --------------- | ---- | --------------------------------------------------- | ----------------------- |
| pages                          | String 、 Array | 是   | 页面路径列表                                        |                         |
| window                         | Object          | 否   | 全局的默认窗口表现                                  |                         |
| tabBar                         | Object          | 否   | 底部 tab 栏的表现                                   |                         |
| networkTimeout                 | Object          | 否   | 网络超时时间                                        |                         |
| debug                          | Boolean         | 否   | 是否开启 debug 模式，默认关闭                       |                         |
| functionalPages                | Boolean         | 否   | 是否启用插件功能页，默认关闭                        | 2.1.0                   |
| subpackages                    | Object Array    | 否   | 分包结构配置                                        | 1.7.3                   |
| workers                        | String          | 否   | Worker 代码放置的目录                               | 1.9.90                  |
| requiredBackgroundModes        | String Array    | 否   | 需要在后台使用的能力，如「音乐播放」                |                         |
| plugins                        | Object          | 否   | 使用到的插件                                        | 1.9.6                   |
| preloadRule                    | Object          | 否   | 分包预下载规则                                      | 2.3.0                   |
| resizable                      | Boolean         | 否   | iPad 小程序是否支持屏幕旋转，默认关闭               | 2.3.0                   |
| navigateToMiniProgramAppIdList | String Array    | 否   | 需要跳转的小程序列表，详见 wx.navigateToMiniProgram | 2.4.0                   |
| usingComponents                | Object          | 否   | 全局自定义组件配置                                  | 开发者工具 1.02.1810190 |
| permission                     | Object          | 否   | 小程序接口权限相关设置                              | 微信客户端 7.0.0        |

接下来是各个配置项的详解

### pages

用于指定小程序由哪些页面组成，每一项都对应一个页面的 路径+文件名 信息。文件名不需要写文件后缀，框架会自动去寻找对于位置的 .json, .js, .wxml, .wxss 四个文件进行处理。

数组的第一项代表小程序的初始页面（首页）。小程序中新增/减少页面，都需要对 pages 数组进行修改。

如开发目录为：

├── app.js
├── app.json
├── app.wxss
├── pages
│ │── index
│ │ ├── index.wxml
│ │ ├── index.js
│ │ ├── index.json
│ │ └── index.wxss
│ │── rank
│ │ ├── rank.wxml
│ │ ├── rank.js
│ │ ├── rank.json
│ │ └── result.wxss
│ │── record
│ │ ├── record.wxml
│ │ ├── record.js
│ │ ├── record.json
│ │ └── record.wxss
│ │── score
│ │ ├── score.wxml
│ │ ├── score.js
│ │ ├── score.json
│ │ └── score.wxss
│ └── logs
│ ├── logs.wxml
│ └── logs.js
└── utils

则需要在 app.json 中写

```json
{
  "pages": [
     "pages/index/index",
     "pages/rank/rank",
     "pages/record/record",
     "pages/score/score"
   ]
}
`
```

### window

用于设置小程序的状态栏、导航条、标题、窗口背景色。

| 属性                         | 类型     | 默认值   | 描述                                                         | 最低版本                                               |
| ---------------------------- | -------- | -------- | ------------------------------------------------------------ | ------------------------------------------------------ |
| navigationBarBackgroundColor | HexColor | #000000  | 导航栏背景颜色，如 #000000                                   |                                                        |
| navigationBarTextStyle       | String   | white    | 导航栏标题颜色，仅支持 black / white                         |                                                        |
| navigationBarTitleText       | String   |          | 导航栏标题文字内容                                           |                                                        |
| navigationStyle              | String   | default  | 导航栏样式，仅支持以下值： default 默认样式 custom 自定义导航栏，只保留右上角胶囊按钮。参见注2。 | 微信客户端 6.6.0                                       |
| backgroundColor              | HexColor | #ffffff  | 窗口的背景色                                                 |                                                        |
| backgroundTextStyle          | String   | dark     | 下拉 loading 的样式，仅支持 dark / light                     |                                                        |
| backgroundColorTop           | String   | #ffffff  | 顶部窗口的背景色，仅 iOS 支持                                | 微信客户端 6.5.16                                      |
| backgroundColorBottom        | String   | #ffffff  | 底部窗口的背景色，仅 iOS 支持                                | 微信客户端 6.5.16                                      |
| enablePullDownRefresh        | Boolean  | false    | 是否开启当前页面的下拉刷新。详见 Page.onPullDownRefresh      |                                                        |
| onReachBottomDistance        | Number   | 50       | 页面上拉触底事件触发时距页面底部距离，单位为px。详见 Page.onReachBottom |                                                        |
| pageOrientation              | String   | portrait | 屏幕旋转设置，支持 auto / portrait / landscape               | 详见 响应显示区域变化 2.4.0 (auto) / 2.5.0 (landscape) |

- 注1：HexColor（十六进制颜色值），如"#ff00ff"
- 注2：关于navigationStyle 客户端 7.0.0 以下版本，navigationStyle 只在 app.json 中生效。 客户端 6.7.2 版本开始，navigationStyle: custom 对 组件无效 开启 custom 后，低版本客户端需要做好兼容。开发者工具基础库版本切到 1.7.0（不代表最低版本，只供调试用）可方便切到旧视觉

##### 代码展示

```js
{
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#1aadf0",
    "navigationBarTitleText": "评分",
    "navigationBarTextStyle": "white"
  }
}
```

##### 效果展示

![窗口配置](amWiki/images/config/window.png)

### tabBar

如果小程序是一个多 tab 应用（客户端窗口的底部或顶部有 tab 栏可以切换页面），可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面。

| 属性            | 类型     | 必填 | 默认值 | 描述                                                 | 最低版本 |
| --------------- | -------- | ---- | ------ | ---------------------------------------------------- | -------- |
| color           | HexColor | 是   | 无     | tab 上的文字默认颜色，仅支持十六进制颜色             |          |
| selectedColor   | HexColor | 是   | 无     | tab 上的文字选中时的颜色，仅支持十六进制颜色         |          |
| backgroundColor | HexColor | 是   | 无     | tab 的背景色，仅支持十六进制颜色                     |          |
| borderStyle     | String   | 否   | black  | tabbar上边框的颜色， 仅支持 black / white            |          |
| list            | Array    | 是   | 无     | tab 的列表，详见 list 属性说明，最少2个、最多5个 tab |          |
| position        | String   | 否   | bottom | tabBar的位置，仅支持 bottom / top                    |          |
| custom          | Boolean  | 否   | false  | 自定义 tabBar，见详情                                | 2.5.0    |

其中 list 接受一个数组，只能配置最少 2 个、最多 5 个 tab。tab 按数组的顺序排序，每个项都是一个对象，其属性值如下：

| 属性             | 类型   | 必填 | 说明                                                         |
| ---------------- | ------ | ---- | ------------------------------------------------------------ |
| pagePath         | String | 是   | 页面路径，必须在 pages 中先定义                              |
| text             | String | 是   | tab 上按钮文字                                               |
| iconPath         | String | 否   | 图片路径，icon 大小限制为40kb，建议尺寸为 81px * 81px，不支持网络图片。当 postion 为 top 时，不显示 icon。 |
| selectedIconPath | String | 否   | 选中时的图片路径，icon 大小限制为40kb，建议尺寸为 81px * 81px，不支持网络图片。当 postion 为 top 时，不显示 icon。 |

##### 代码展示

配置tabBar的文字颜色和选中时候文字的颜色，背景颜色。list选项中配置每一个tabBar的文字、路径、图片路径以及选中时候图片的路径。另外还需要在根目录下新建images文件夹，用来存放图片。

```json
{
"tabBar": {
    "color": "#b8b8b8",
    "selectedColor": "#51bcf9",
    "backgroundColor": "#fff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "images/index-none.png",
        "selectedIconPath": "images/index.png"
      },
      {
        "pagePath": "pages/rank/rank",
        "text": "排名",
        "iconPath": "images/ranking-none.png",
        "selectedIconPath": "images/ranking.png"
      },
      {
        "pagePath": "pages/record/record",
        "text": "评分记录",
        "iconPath": "images/record-none.png",
        "selectedIconPath": "images/record.png"
      }
    ]
  }
}
```

##### 效果展示

![tabbar](amWiki/images/config/tabbar.PNG)

### networkTimeout

各类网络请求的超时时间，单位均为毫秒。

| 属性          | 类型   | 必填 | 默认值 | 说明                                      |
| ------------- | ------ | ---- | ------ | ----------------------------------------- |
| request       | Number | 否   | 60000  | wx.request 的超时时间，单位：毫秒。       |
| connectSocket | Number | 否   | 60000  | wx.connectSocket 的超时时间，单位：毫秒。 |
| uploadFile    | Number | 否   | 60000  | wx.uploadFile 的超时时间，单位：毫秒。    |
| downloadFile  | Number | 否   | 60000  | wx.downloadFile 的超时时间，单位：毫秒。  |

### debug

可以在开发者工具中开启 debug 模式，在开发者工具的控制台面板，调试信息以 info 的形式给出，其信息有Page的注册，页面路由，数据更新，事件触发等。可以帮助开发者快速定位一些常见的问题。

### functionalPages

基础库 2.1.0 开始支持，低版本需做兼容处理。

启用插件功能页时，插件所有者小程序需要设置其 functionalPages 为 true。

### subpackages

微信客户端 6.6.0 ，基础库 1.7.3 及以上版本支持

启用分包加载时，声明项目分包结构。

写成 subPackages 也支持。

### workers

基础库 1.9.90 开始支持，低版本需做兼容处理。

使用 Worker 处理多线程任务时，设置 Worker 代码放置的目录

### requiredBackgroundModes

微信客户端 6.7.2 及以上版本支持

申明需要后台运行的能力，类型为数组。目前支持以下项目：

audio: 后台音乐播放 如：

```
{
  "pages": ["pages/index/index"],
  "requiredBackgroundModes": ["audio"]
}
```

注：在此处申明了后台运行的接口，开发版和体验版上可以直接生效，正式版还需通过审核。

### plugins

基础库 1.9.6 开始支持，低版本需做兼容处理。

声明小程序需要使用的插件。

### preloadRule

基础库 2.3.0 开始支持，低版本需做兼容处理。

声明分包预下载的规则。

### resizable

基础库 2.3.0 开始支持，低版本需做兼容处理。

在 iPad 上运行的小程序可以设置支持屏幕旋转。

### navigateToMiniProgramAppIdList

基础库 2.4.0 开始支持，低版本需做兼容处理。

当小程序需要使用 wx.navigateToMiniProgram 接口跳转到其他小程序时，需要先在配置文件中声明需要跳转的小程序 appId 列表，最多允许填写 10 个。

### usingComponents

开发者工具 1.02.1810190 及以上版本支持

在此处声明的自定义组件视为全局自定义组件，在小程序内的页面或自定义组件中可以直接使用而无需再声明。

### permission

微信客户端 7.0.0 及以上版本支持

小程序接口权限相关设置。字段类型为 Object，结构为：

| 属性               | 类型             | 必填 | 默认值 | 描述             |
| ------------------ | ---------------- | ---- | ------ | ---------------- |
| scope.userLocation | PermissionObject | 否   | 无     | 位置相关权限声明 |

### PermissionObject 结构

| 属性 | 类型   | 必填 | 默认值 | 说明                                             |
| ---- | ------ | ---- | ------ | ------------------------------------------------ |
| desc | string | 是   | 无     | 小程序获取权限时展示的接口用途说明。最长30个字符 |

```json
{
 "pages": ["pages/index/index"],
 "permission": {
   "scope.userLocation": {
     "desc": "你的位置信息将用于小程序位置接口的效果展示"
   }
 }
}
```

## 页面配置

每一个小程序页面也可以使用.json文件来对本页面的窗口表现进行配置。

页面的配置只能设置 app.json 中部分 window 配置项的内容，页面中配置项会覆盖 app.json 的 window 中相同的配置项。

| 属性                         | 类型     | 默认值             | 描述                                                         | 最低版本                                               |
| ---------------------------- | -------- | ------------------ | ------------------------------------------------------------ | ------------------------------------------------------ |
| navigationBarBackgroundColor | HexColor | #000000            | 导航栏背景颜色，如 #000000                                   |                                                        |
| navigationBarTextStyle       | String   | white              | 导航栏标题颜色，仅支持 black / white                         |                                                        |
| navigationBarTitleText       | String   | 导航栏标题文字内容 |                                                              |                                                        |
| navigationStyle              | String   | default            | 导航栏样式，仅支持以下值：default 默认样式custom 自定义导航栏，只保留右上角胶囊按钮 | 微信客户端 7.0.0                                       |
| backgroundColor              | HexColor | #ffffff            | 窗口的背景色                                                 |                                                        |
| backgroundTextStyle          | String   | dark               | 下拉 loading 的样式，仅支持 dark / light                     |                                                        |
| backgroundColorTop           | String   | #ffffff            | 顶部窗口的背景色，仅 iOS 支持                                | 微信客户端 6.5.16                                      |
| backgroundColorBottom        | String   | #ffffff            | 底部窗口的背景色，仅 iOS 支持                                | 微信客户端 6.5.16                                      |
| enablePullDownRefresh        | Boolean  | false              | 是否全局开启下拉刷新。详见 Page.onPullDownRefresh            |                                                        |
| onReachBottomDistance        | Number   | 50                 | 页面上拉触底事件触发时距页面底部距离，单位为px。详见 Page.onReachBottom |                                                        |
| pageOrientation              | String   | portrait           | 屏幕旋转设置，支持 auto / portrait / landscape               | 详见 响应显示区域变化 2.4.0 (auto) / 2.5.0 (landscape) |
| disableScroll                | Boolean  | false              | 设置为 true 则页面整体不能上下滚动。只在页面配置中有效，无法在 app.json 中设置 |                                                        |
| disableSwipeBack             | Boolean  | false              | 禁止页面右滑手势返回                                         | 微信客户端 7.0.0                                       |
| usingComponents              | Object   | 否                 | 页面自定义组件配置                                           | 1.6.3                                                  |

页面的.json只能设置 window 相关的配置项，以决定本页面的窗口表现，所以无需写 window 这个属性。
